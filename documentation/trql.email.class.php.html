<style>
.trql_documentor_DocumentorSourceFile { margin: 1em 1em; padding: 1em; border: 1px solid #000; box-sizing: border-box; }
.trql_documentor_DocumentorSourceFile * { box-sizing: border-box; }
.trql_documentor_DocumentorSourceFile hr { border-top: 4px solid #800 !important; margin:2em 0; box-shadow: 0 6px 10px 1px rgba(0,0,0,.2); }
.trql_documentor_DocumentorSourceFile pre { background: #c001; }
.trql_documentor_DocumentorSourceFile pre strong { color: #b00; }
.DocumentorLabel { font-style: italic; display: block; margin-top:1em; }
.property { font-weight: bold;}
.shadow { box-shadow: 0 20px 15px -15px rgba(0,0,0,.5); }
.constrained { max-width: 100%; height: auto; }
.center { text-align:center; }
code,samp, .filename {color: #800 !important;
   font-family: Consolas,"courier new";
   background: rgba(240, 240, 240, 0.5);
   border: 1px solid silver;
   border-radius: 3px;
   padding: 0px 5px; }
.seealso code a {text-decoration:none;
   color: #800 !important;
   font-weight: bold;
   font-style: italic;
   }
.property.inheritance code { border: none !important; }
.assert.success { border: 2px solid green; padding: 5px; border-radius:3px; }
.assert.failure { border: 2px solid red; padding: 5px; border-radius:3px; }
.assert.success code, .assert.failure code { border: none !important; }
.DocumentorLabel { font-style: italic; display: block;}
section.class { margin: 1em 1em; padding: 1em; border: 1px solid #000; background: #eee9; }
img.vaesoli-image { border:1px solid silver; padding: 1em; display: block;}
table.properties { border:1px solid silver; border-collapse: collapse; width:100%; }
table.properties thead th { border:1px solid silver;padding: .5em; width:20%; }
table.properties thead th.description { width:60%; }
table.properties tr.property td,
table.properties tr.parameter td { border:1px solid silver;padding: .5em; width:20%; }
table.properties tr.property td.description,
table.properties tr.parameter td.description { width: 60%; }
p.property.func { font: .9em/1em lucida,georgia,"times new roman",serif;
   letter-spacing: 3px;
   width: 100%;
   margin: 0 0 15px 0;
   padding: 5px;
   color: rgb(255,128,0);
   padding: 1em;
   border: 1px solid #999;
   box-shadow: 0 0 5px 5px rgb(200 200 200 / 30%);
   border: 1px solid #888; }
</style>

<div class="trql_documentor_DocumentorSourceFile">
<section class="header">
<span class="DocumentorLabel">Filename: </span><span class="property filename">trql.email.class.php</span>
<span class="DocumentorLabel">Namespace: </span><span class="property namespace"><code>trql\quitus</code></span>
<span class="DocumentorLabel">Class aliases: </span><span class="property aliases"><code>\trql\vaesoli\Vaesoli as Vaesoli,\trql\utility\Utility as Utility,\trql\html\Form as Form,\trql\html\Fieldset as Fieldset,\trql\html\Formset as Formset,\trql\html\Input as Input,\trql\emailmessage\EmailMessage as EmailMessage</code></span>
<span class="DocumentorLabel">Purpose: </span><span class="property purpose">A set of services to create and send an email message.</span>
<span class="DocumentorLabel">Author: </span><span class="property author">Pat Y. Boens</span>
<span class="DocumentorLabel">Company: </span><span class="property company">Lato Sensu Management<br />Rue du Bois des Mazuis, 47<br />5070 Vitrival<br />Belgium<br /><a href="https://www.latosensu.be" class="DocumentorLink" title="Go to https://www.latosensu.be" itemprop="url">https://www.latosensu.be</a> (geonames: <a href="http://api.geonames.org/get?geonameId=8520400&username=demo&style=full" class="DocumentorLink" title="Go to http://api.geonames.org/get?geonameId=8520400&username=demo&style=full" itemprop="url">http://api.geonames.org/get?geonameId=8520400&username=demo&style=full</a>)<br />Vae Soli!: <a href="http://www.vaesoli.com" class="DocumentorLink" title="Go to http://www.vaesoli.com" itemprop="url">http://www.vaesoli.com</a><br /></span>
<span class="DocumentorLabel">Creation date: </span><span class="property cdate">19-01-21 07:14</span>
<span class="DocumentorLabel">Last modification date: </span><span class="property mdate">22/03/2021 - 16:06:30</span>
<span class="DocumentorLabel">License/Copyrights: </span><span class="property license">Intellectual Property belongs to Pat Y. Boens. You are free to:<br /><br /><strong>Share</strong> — copy and redistribute the material in any medium or format<br /><strong>Adapt</strong> — remix, transform, and build upon the material for any purpose, even commercially.<br /><br />Under the following terms:<br /><br /><strong>Attribution</strong> — You must give appropriate credit, provide a link to the license, and indicate if changes were made. You may do so in any reasonable manner, but not in any way that suggests the licensor endorses you or your use.<br /><br /><strong>No additional restrictions</strong> — You may not apply legal terms or technological measures that legally restrict others from doing anything the license permits.<br /><br /><a href="https://creativecommons.org/licenses/by/4.0/legalcode" class="DocumentorLink" title="Go to https://creativecommons.org/licenses/by/4.0/legalcode" itemprop="url">https://creativecommons.org/licenses/by/4.0/legalcode</a></span>
</section> <!-- .header -->
<section class="classes">
<section class="class shadow">
<span class="DocumentorLabel">Class: </span><span class="property classname"><code>Email</code></span>
<span class="DocumentorLabel">Description: </span><span class="property description">A set of services to create and send an email message.</span>
<span class="DocumentorLabel">Inheritance: </span><span class="property inheritance"><code><a href="?src=Mother">Mother</a> &gt; <a href="?src=Utility">Utility</a> &gt; Email</code></span>
<span class="DocumentorLabel">Declaration: </span><span class="property declaration"><code>class Email extends Utility</code></span>
<span class="DocumentorLabel">Properties: </span>
<table class="properties">
<thead>
<tr>
<th class="name">Name</th>
<th class="type">Type</th>
<th class="description">Description</th>
</tr>
</thead>
<tr class="property">
<td class="name" id="var.aFiles"><code>$aFiles</code></td>
<td class="type"><code>string</code></td>
<td class="description">List of attachments</td>
</tr>
<tr class="property">
<td class="name" id="var.iPort"><code>$iPort</code></td>
<td class="type"><code>int</code></td>
<td class="description">Connection port. <code>25</code> by default.</td>
</tr>
<tr class="property">
<td class="name" id="var.iPriority"><code>$iPriority</code></td>
<td class="type"><code>int</code></td>
<td class="description">Mail priority (1 = highest ... 5 = lowest). <code>3</code> by default.</td>
</tr>
<tr class="property">
<td class="name" id="var.self"><code>$self</code></td>
<td class="type"><code>array</code></td>
<td class="description">Fixed 'class' information.</td>
</tr>
<tr class="property">
<td class="name" id="var.szBCC"><code>$szBCC</code></td>
<td class="type"><code>string</code></td>
<td class="description">Blind copy email address</td>
</tr>
<tr class="property">
<td class="name" id="var.szBody"><code>$szBody</code></td>
<td class="type"><code>string</code></td>
<td class="description">Body of the mail</td>
</tr>
<tr class="property">
<td class="name" id="var.szCC"><code>$szCC</code></td>
<td class="type"><code>string</code></td>
<td class="description">Email address of copy</td>
</tr>
<tr class="property">
<td class="name" id="var.szCharset"><code>$szCharset</code></td>
<td class="type"><code>string</code></td>
<td class="description">Character set. '<code>UTF-8</code>' by default;</td>
</tr>
<tr class="property">
<td class="name" id="var.szDomain"><code>$szDomain</code></td>
<td class="type"><code>string</code></td>
<td class="description">Domaine internet</td>
</tr>
<tr class="property">
<td class="name" id="var.szFromEmail"><code>$szFromEmail</code></td>
<td class="type"><code>string</code></td>
<td class="description">Sender Email address</td>
</tr>
<tr class="property">
<td class="name" id="var.szFromName"><code>$szFromName</code></td>
<td class="type"><code>string</code></td>
<td class="description">Sender name</td>
</tr>
<tr class="property">
<td class="name" id="var.szHost"><code>$szHost</code></td>
<td class="type"><code>string</code></td>
<td class="description">Host to connect to</td>
</tr>
<tr class="property">
<td class="name" id="var.szLogFile"><code>$szLogFile</code></td>
<td class="type"><code>string</code></td>
<td class="description">Possible log file</td>
</tr>
<tr class="property">
<td class="name" id="var.szMailType"><code>$szMailType</code></td>
<td class="type"><code>string</code></td>
<td class="description">Mail format. '<code>text/plain</code>' by default (can also be'<code>text/html)</code>'.</td>
</tr>
<tr class="property">
<td class="name" id="var.szSubject"><code>$szSubject</code></td>
<td class="type"><code>string</code></td>
<td class="description">Subject of the email</td>
</tr>
<tr class="property">
<td class="name" id="var.szTo"><code>$szTo</code></td>
<td class="type"><code>string</code></td>
<td class="description">Recipient's email address (can be multiple with a ',' separated string</td>
</tr>
<tr class="property">
<td class="name" id="var.ttl"><code>$ttl</code></td>
<td class="type"><code>int</code></td>
<td class="description">Time-to-Live in sec; 1 full day by default</td>
</tr>
<tr class="property">
<td class="name" id="var.wikidataId"><code>$wikidataId</code></td>
<td class="type"><code>string</code></td>
<td class="description">Wikidata ID. A single message, sent by email</td>
</tr>
</table>
<h2 class="DocumentorLabel">Methods of <code>Email</code></h2>
<p class="property func" id="fnc.__construct"><span class="name"><strong><code>__construct()</code></strong></span>: Class constructor</p>
<p class="property">Keywords:</p>
<p>constructors, destructors</p>
<p class="property">Syntax:</p>
<p><code>__construct( $szHome )</code></p>
<span class="DocumentorLabel">Parameters: </span>
<table class="properties">
<thead>
<tr>
<th class="name">Name</th>
<th class="type">Type</th>
<th class="description">Description</th>
</tr>
</thead>
<tr class="parameter">
<td class="name" id="param.__construct.szHome"><code>$szHome</code></td>
<td class="type"><code>string</code></td>
<td class="description seealso">Home of the class. Optional.</td>
</tr>
</table>
<p class="property return">Return:</p>
<p class="seealso">(self):  The current instance of the class</p>
<span class="DocumentorLabel">See also: </span><span class="property seealso"><code><a href="#fnc.__destruct">__destruct()</a></code></span>
<hr /><p class="property func" id="fnc.__destruct"><span class="name"><strong><code>__destruct()</code></strong></span>: Class destructor</p>
<p class="property">Keywords:</p>
<p>constructors, destructors</p>
<p class="property">Syntax:</p>
<p><code>__destruct()</code></p>
<p class="property return">Return:</p>
<p class="seealso">(void):  No return</p>
<span class="DocumentorLabel">See also: </span><span class="property seealso"><code><a href="#fnc.__construct">__construct()</a></code></span>
<hr /><p class="property func" id="fnc.DNSRecord"><span class="name"><strong><code>DNSRecord()</code></strong></span>: Return the DNS record of a domain</p>
<p class="property">Keywords:</p>
<p>constructors, destructors</p>
<p class="property">Syntax:</p>
<p><code>DNSRecord( $szDomain )</code></p>
<span class="DocumentorLabel">Parameters: </span>
<table class="properties">
<thead>
<tr>
<th class="name">Name</th>
<th class="type">Type</th>
<th class="description">Description</th>
</tr>
</thead>
<tr class="parameter">
<td class="name" id="param.DNSRecord.szDomain"><code>$szDomain</code></td>
<td class="type"><code>string</code></td>
<td class="description seealso">The domain to get the DNS Record of</td>
</tr>
</table>
<p class="property return">Return:</p>
<p class="seealso">(array):  Associative array if method is successful; <code>null</code>
 otherwise.</p>
<span class="DocumentorLabel">See also: </span><span class="property seealso"><code><a href="#fnc.__construct">__construct()</a></code></span>
<hr /><p class="property func" id="fnc.isEmail"><span class="name"><strong><code>isEmail()</code></strong></span>: Checks whether an email address can supposedly exist (DNS check)</p>
<p class="property">Warning:</p>
<p>Only the domain is checked for existence. If the email address is 
 valid on an existing domain, the method will return a <code>true</code>
 even though the email address does not really exist.</p>
<p class="property">Syntax:</p>
<p><code>isEmail( $szEmail )</code></p>
<span class="DocumentorLabel">Parameters: </span>
<table class="properties">
<thead>
<tr>
<th class="name">Name</th>
<th class="type">Type</th>
<th class="description">Description</th>
</tr>
</thead>
<tr class="parameter">
<td class="name" id="param.isEmail.szEmail"><code>$szEmail</code></td>
<td class="type"><code>string</code></td>
<td class="description seealso">The email address to check</td>
</tr>
</table>
<p class="property return">Return:</p>
<p class="seealso">(bool):  <code>true</code> if email address exists (supposedly);
 <code>false</code> otherwise.</p>
<p class="property">Example(s):</p>
<pre>

  use \trql\quitus\Email as Email;

  if ( ! defined( 'EMAIL_CLASS_VERSION' ) )
      require_once( 'd:/websites/snippet-center/trql.email.class.php' );

  // The Email object that will do the dirty work
  $oEmail = new Email();

  var_dump( ( <strong>$oEmail->isEmail( $szEmail = 'john.doe@latosensu.be'        )</strong> ? '"true"' : '"false"' ) . ' for "' . $szEmail . '"' );
  var_dump( ( <strong>$oEmail->isEmail( $szEmail = 'john.doe@gmail.com'           )</strong> ? '"true"' : '"false"' ) . ' for "' . $szEmail . '"' );
  var_dump( ( <strong>$oEmail->isEmail( $szEmail = 'john.doe@microsoft.com'       )</strong> ? '"true"' : '"false"' ) . ' for "' . $szEmail . '"' );
  var_dump( ( <strong>$oEmail->isEmail( $szEmail = 'john.doe@latosensu.co.uk'     )</strong> ? '"true"' : '"false"' ) . ' for "' . $szEmail . '"' );
  var_dump( ( <strong>$oEmail->isEmail( $szEmail = 'completely wrong'             )</strong> ? '"true"' : '"false"' ) . ' for "' . $szEmail . '"' );
  var_dump( ( <strong>$oEmail->isEmail( $szEmail = 'pb@thisdomaindoesnotexist.be' )</strong> ? '"true"' : '"false"' ) . ' for "' . $szEmail . '"' );
  var_dump( ( <strong>$oEmail->isEmail( $szEmail = 'pb@trql.fm'                   )</strong> ? '"true"' : '"false"' ) . ' for "' . $szEmail . '"' );
  var_dump( ( <strong>$oEmail->isEmail( $szEmail = 'pb@ls.co'                     )</strong> ? '"true"' : '"false"' ) . ' for "' . $szEmail . '"' );
  </pre>
<hr /><p class="property func" id="fnc.send"><span class="name"><strong><code>send()</code></strong></span>: Sends a mail</p>
<p class="property">Warning:</p>
<p>Cannot send attachments for the time being (22-03-21 07:42:20)</p>
<p class="property">Syntax:</p>
<p><code>send()</code></p>
<p class="property return">Return:</p>
<p class="seealso">(int):  Returns an int corresponding to one of the return codes:<br /><br />

 <code>define( 'EMAIL_RET_CODES' ,0 );</code><br /><br />

 <code>define( 'EMAIL_RET_CODE_OK' ,EMAIL_RET_CODES + 0 )</code><br />
 <code>define( 'EMAIL_RET_CODE_NO_RECIPIENT' ,EMAIL_RET_CODES - 100 )</code><br />
 <code>define( 'EMAIL_RET_CODE_MAIL_NOT_SENT' ,EMAIL_RET_CODES - 200 )</code><br /><br /></p>
<p class="property">Example(s):</p>
<pre>

      /* ============================= */
      /* <strong>EXAMPLE #1 : SIMPLE MAIL</strong>      */
      /* ============================= */
      use \trql\vaesoli\Vaesoli   as V;
      use \trql\quitus\Email      as Email;

      if ( ! defined( "VAESOLI_CLASS_VERSION ") )
          require_once( 'trql.vaesoli.class.php' );

      if ( ! defined( 'EMAIL_CLASS_VERSION' ) )
          require_once( 'trql.email.class.php' );

      if ( ! defined( 'EMAIL_RET_CODES' ) )
      {
          define( 'EMAIL_RET_CODES'               ,0  );

          define( 'EMAIL_RET_CODE_OK'             ,EMAIL_RET_CODES +   0 );
          define( 'EMAIL_RET_CODE_NO_RECIPIENT'   ,EMAIL_RET_CODES - 100 );
          define( 'EMAIL_RET_CODE_MAIL_NOT_SENT'  ,EMAIL_RET_CODES - 200 );
      }

      <strong>$oEmail = new Email();

      $oEmail->szMailType     = 'text/html';
      $oEmail->szCharset      = 'UTF-8';
      $oEmail->szHost         = 'localhost';
      $oEmail->iPort          = 25;
      $oEmail->szFromName     = 'Beautiful Company';
      $oEmail->szDomain       = 'beautifulcompany.com';
      $oEmail->szFromEmail    = 'noreply@beautifulcompany.com';
      $oEmail->szFromName     = 'Email Robot';
      $oEmail->szTo           = 'friend@beautifulcompany.com';
      $oEmail->szSubject      = 'Hello';
      $oEmail->szBody         = '&lt;p&gt;Dear Fiend,&lt;/p&gt; &lt;p&gt;I just wanted to say 'Hello' to you.&lt;/p&gt; &lt;p&gt;Kind regards.&lt;/p&gt;';</strong>

      try
      {
          if ( <strong>$oEmail->send() !== EMAIL_RET_CODE_OK</strong> )
          {
              echo "&lt;p&gt;PROBLEM with {$oEmail-&gt;szTo}&lt;/p&gt;\n";
          }
      }
      catch ( exception $e)
      {
          echo 'Exception: ',  $e->getMessage(), "\n";
      }


      /* ============================= */
      /* <strong>EXAMPLE #2 : MAILSHOT EXAMPLE</strong> */
      /* ============================= */
      use \trql\vaesoli\Vaesoli   as V;
      use \trql\quitus\Email      as Email;

      if ( ! defined( "VAESOLI_CLASS_VERSION ") )
          require_once( 'd:/websites/snippet-center/trql.vaesoli.class.php' );

      if ( ! defined( 'EMAIL_CLASS_VERSION' ) )
          require_once( 'd:/websites/snippet-center/trql.email.class.php' );

      if ( ! defined( 'EMAIL_RET_CODES' ) )
      {
          define( 'EMAIL_RET_CODES'               ,0  );

          define( 'EMAIL_RET_CODE_OK'             ,EMAIL_RET_CODES +   0 );
          define( 'EMAIL_RET_CODE_NO_RECIPIENT'   ,EMAIL_RET_CODES - 100 );
          define( 'EMAIL_RET_CODE_MAIL_NOT_SENT'  ,EMAIL_RET_CODES - 200 );
      }

      /* The example depicted in here is working as follows

          1) We have a .hash file where all contacts are stored in the
             /../databases/clean-up folder
          2) All contacts are maintained in the mailshot-easter.hash.normalized.hash
             file and will be loaded in the aRecipients array which looks like this:

             aRecipients is an array of elements such as:
             '625b57c1437620d016b6612121e86b19' =>
               array (size=10)
                 'lastname' => string 'Doe'
                 'firstname' => string 'John'
                 'address' => string 'Rue de Londres, 45'
                 'postalcode' => string '1000'
                 'city' => string 'Brussels'
                 'country' => string 'Belgiium'
                 'phone' => string '+32475112233'
                 'isMobilePhone' => boolean true
                 'phone_normalized' => string '+32475112233'
                 'email' => string 'john.doe@gmail.com' (length=20)

          3) We will send an email to each contact. The text of the email
             is stored in a template : mailshot-easter-mail.txt

          4) For each contact, we will adapt the text of the template by
             applying some substitutions

          5) We send the email

      */

      /* mailshot-easter-mail.txt template content : SAMPLE

          <i>&lt;!DOCTYPE html&gt;
          &lt;html lang=&quot;en&quot;&gt;
              &lt;head&gt;
                  &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;
                  &lt;title&gt;Easter Menu Take-away&lt;/title&gt;
                  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1&quot; /&gt;
                  &lt;style type=&quot;text/css&quot;&gt;
                     body { background-color: rgba(119,73,50,.1);
                            color: #6c4b45;
                            width: 100%;
                            margin: 0;
                            padding: 0;
                            font: 1em/1.5em verdana,arial,sans-serif; }
                     footer,#wrapper { width: 90%;
                             margin: 0 auto;
                             padding: 1em;
                             background: #fff;
                             font-size: .8em
                     }
                     footer { background-color: rgba(119,73,50,.1);
                              color: #fff;
                              font-size: .7em;
                     }
                     h1 { font: 1em/1.5em verdana,arial,sans-serif; }
                     blockquote { background-color: rgba(119,73,50,.2);
                         border: 1px solid #774932;
                         padding: 1.5em; }
                  &lt;/style&gt;
              &lt;/head&gt;

              &lt;body&gt;
                  &lt;div id=&quot;wrapper&quot;&gt;
                      &lt;p&gt;Dear %name()%,&lt;/p&gt;

                      &lt;p&gt;The &lt;strong&gt;Beautiful Restaurant's Easter Menu&lt;/strong&gt; is
                      available to order while waiting for the long
                      awaited official reopening of our restaurant&lt;/p&gt;

                      &lt;p&gt;Here is our &lt;a href=&quot;%url%&quot;&gt;Easter Menu&lt;/a&gt; so
                      that you can stay cheerful even during this
                      particularly difficult time&lt;/p&gt;

                      &lt;p&gt;Closing date for orders is 02/04/2021, 18:00 at +32 111 22 33 44. Pick up on
                      03/04/2021, from 14h to 18h.&lt;/p&gt;

                      &lt;p&gt;Thank you and see you soon. The Beautiful Restaurant team.&lt;/p&gt;

                      &lt;p class=&quot;center&quot;&gt;&lt;img
                      src=&quot;http://www.beautifulrestaurant.com/images/chef-very-small.jpg&quot;
                      width=&quot;123&quot; height=&quot;250&quot;
                      title=&quot;Here is The Chef!&quot; alt=&quot;The say of The Chef trumps anything else&quot; /&gt;&lt;/p&gt;

                      &lt;p&gt;NB: Please note that this email was sent to you
                      from an address that cannot receive a reply. Please
                      do not reply to this message.&lt;/p&gt;

                      &lt;p&gt;&lt;strong&gt;WARNING&lt;/strong&gt; : We respect your
                      privacy. We are particularly careful not to &quot;spam&quot;
                      you and we are very sorry if this was the case.
                      Therefore, if you do not wish to receive any more
                      emails from us, simply click on the following link
                      to let us know&amp;#160;: &lt;a
                      href=&quot;http://www.beautifulrestaurant.com/unregister.html?key
                      =%key%&quot;&gt;NO SPAM&lt;/a&gt;! Hope to see you soon.&lt;/p&gt;

                  &lt;/div&gt; &lt;!-- wrapper --&gt;

                  &lt;div id=&quot;tripadvisor&quot;&gt;
                      &lt;p&gt;Don't forget to leave us a comment on &lt;a
                      href=&quot;http://www.beautifulrestaurant.com/tripadvisor&quot;&gt;TripAdvisor&lt;/a&gt;. Thanks in advance.&lt;/p&gt;
                  &lt;/div&gt; &lt;!-- tripadvisor --&gt;

                  &lt;footer&gt;
                      &lt;a href=&quot;http://www.beautifulrestaurant.com/legal/&quot;
                         title=&quot;Terms of service&quot;&gt;&amp;copy; 2001 - %year()%
                         Beautiful Restaurant, all rights reserved&lt;/a&gt; &amp;#8212; Avenue Houba de Strooper 96,
                         1020 Bruxelles &amp;#8212 Phone : &lt;a href=&quot;tel:+32111223344&quot;&gt;+32 111 22 33 44&lt;/a&gt;
                         &amp;#8212; Fax : +32 2 123 45 67 &amp;#8212; Design by &lt;a href=&quot;tel:+32495526020&quot;&gt;Pat
                         Boens &amp;#8211 +32 495 52 60 20&lt;/a&gt; &amp;#8212;
                         Powered by  &lt;a href=&quot;http://www.quitus.be&quot;&gt;Quitus&lt;/a&gt;
                  &lt;/footer&gt;
              &lt;/body&gt;
          &lt;/html&gt;</i>

      */


      <strong>// Where data are located
      $szDir      = V::FIL_RealPath( V::FIL_ResolveRoot( '/../databases/clean-up' ) );
      // Where all email addresses are stored
      $szInput    = v::FIL_RealPath( $szDir  . '/mailshot-easter.hash.normalized.hash' );
      // The mail template
      $szTemplate = v::FIL_FileToStr( $szDir . '/mailshot-easter-mail.txt'  );
      // The Email object that will do the dirty work
      $oEmail     = new Email();
      // The list of Mails for which we experienced some problems
      $aProblems  = null;
      // An index
      $i          = 0;
      // Good emails
      $iGood      = 0;

      set_time_limit(0);

      // A var for the substitutions to perform
      $szURL      = 'http://www.beautifulrestaurant.com/special-menus/';

      // A set of substitutions to perform
      // Very suboptimal but it does the job
      $aSubstitutions = array( array( 'pattern'   => '%firstname%'    ,
                                      'field'     => 'firstname'      ,
                                    )                                 ,
                               array( 'pattern'   => '%lastname%'     ,
                                      'field'     => 'lastname'       ,
                                    )                                 ,
                               array( 'pattern'   => '%url%'          ,
                                      'value'     => $szURL           ,
                                    )                                 ,
                               array( 'pattern'   => '%name()%'       ,
                                      'func'      => "name"           ,
                                    )                                 ,
                               array( 'pattern'   => '%year()%'       ,
                                      'func'      => "year"           ,
                                    )                                 ,
                             );

      // Get all people that ever registered with the Beautiful Restaurant
      if ( is_array( $aRecipients = @V::getHashFile( $szInput ) ) )
      {
          foreach( $aRecipients as $key => $aRecipient )
          {
              $szBody = $szTemplate;
              $szBody = str_replace( '%key%',$key,$szBody );

              foreach( $aSubstitutions as $aSubst )
              {
                  $szPattern  = $aSubst['pattern'];
                  $szValue    = '';

                  if     ( ! empty( $aSubst['field'] ) )
                  {   $szField = $aSubst['field'];
                      $szValue = $aRecipient[$szField];
                  }
                  elseif ( ! empty( $aSubst['value'] ) )
                      $szValue = $aSubst['value'];
                  elseif ( ! empty( $aSubst['func'] ) )
                      $szValue = ($aSubst['func'])($aRecipient);

                  $szBody = str_replace( $szPattern,$szValue,$szBody );
              }

              $oEmail->szMailType     = 'text/html';
              $oEmail->szCharset      = 'UTF-8';
              $oEmail->szHost         = 'localhost';
              $oEmail->iPort          = 25;
              $oEmail->szFromName     = 'Beautiful Restaurant';
              $oEmail->szDomain       = 'beautifulrestaurant.com';
              $oEmail->szFromEmail    = 'noreply@beautifulrestaurant.com';
              $oEmail->szFromName     = 'Email Robot';
              $oEmail->szTo           = 'friend@beautifulrestaurant.com';
              $oEmail->szSubject      = 'Hello';
              $oEmail->szBody         = $szBody;

              echo htmlentities( $szBody ),"&lt;hr /&gt;";
              ob_flush();
              flush();

              try
              {
                  if ( $oEmail->send() === EMAIL_RET_CODE_OK )
                  {
                      ++$iGood;
                  }
                  else
                  {
                      $aProblems[] = $aRecipient;
                      echo "&lt;p&gt;PROBLEM with {$aRecipient['email']}&lt;/p&gt;\n";
                  }
              }
              catch ( exception $e)
              {
                  $aProblems[] = $aRecipient;
                  echo "&lt;p&gt;PROBLEM with {$aRecipient['email']}&lt;/p&gt;\n";
                  echo 'Exception reçue : ', $e->getMessage(),"\n";
              }
          }   /* foreach( $aRecipients as $key => $aRecipient ) */
      }   /* if ( is_array( $aRecipients = @V::getHashFile( $szInput ) ) ) */

      if ( ! is_null( $aProblems ) )
      {
          var_dump( count( $aProblems ) . ' problems found sending the mails',$aProblems );

          if ( @V::saveHashFile( $szOutput = v::FIL_RealPath( $szDir . '/mails.problems.hash' ),$aProblems ) )
              var_dump( "PROBLEMS SAVED TO {$szOutput}" );
          else
              var_dump( "PROBLEMS CANNOT BE SAVED TO {$szOutput}" );
      }

      echo "&lt;p&gt;End of the script&lt;/p&gt;";

      function name( $aRecipient )
      /* ---------------------- */
      {
          return ( trim( trim( $aRecipient['firstname'] ) . ' ' . trim( $aRecipient['lastname'] ) ) );
      }

      function year( $aRecipient )
      /* ---------------------- */
      {
          return ( date('Y') );
      }</strong>
  </pre>
<hr /></section> <!-- .class -->
</section> <!-- .classes -->
</div> <!-- End of trql_documentor_DocumentorSourceFile-->
